"use client";

import { useEffect, useState } from "react";
import { 
  FaLaptop, FaDesktop, FaTablet, FaProjectDiagram, FaBox,
  FaUsers, FaUserTie, FaSchool, FaChartBar, FaExclamationTriangle,
  FaTools, FaCheckCircle, FaClock, FaMapMarkerAlt
} from "react-icons/fa";
import { useRouter } from "next/navigation";
import apiClient from "@/app/utils/api";
import DashboardLayout from "@/app/components/DashboardLayout";
import { getToken } from "@/app/utils/auth";

const StatCard = ({ 
  icon: IconComponent, 
  label, 
  count, 
  color,
  bgColor,
  subtitle
}: { 
  icon: React.ComponentType<any>
  label: string
  count: number | string
  color: string
  bgColor: string
  subtitle?: string
}) => (
  <div
    style={{
      backgroundColor: "white",
      borderRadius: "12px",
      padding: "1.5rem",
      boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)",
      display: "flex",
      alignItems: "center",
      gap: "1.5rem",
      transition: "all 0.3s ease",
      cursor: "pointer",
      border: `2px solid ${bgColor}20`,
      minHeight: "120px"
    }}
    onMouseEnter={(e) => {
      e.currentTarget.style.boxShadow = "0 6px 20px rgba(0, 0, 0, 0.15)";
      e.currentTarget.style.transform = "translateY(-4px)";
    }}
    onMouseLeave={(e) => {
      e.currentTarget.style.boxShadow = "0 2px 8px rgba(0, 0, 0, 0.1)";
      e.currentTarget.style.transform = "translateY(0)";
    }}
  >
    <div
      style={{
        width: "70px",
        height: "70px",
        borderRadius: "12px",
        backgroundColor: `${bgColor}20`,
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        flexShrink: 0,
      }}
    >
      <IconComponent size="35" color={color} />
    </div>
    <div style={{ flex: 1 }}>
      <p style={{ margin: 0, color: "#666", fontSize: "0.875rem", fontWeight: "500" }}>{label}</p>
      <p style={{ margin: "0.5rem 0 0 0", fontSize: "2.25rem", fontWeight: "bold", color }}>
        {count}
      </p>
      {subtitle && (
        <p style={{ margin: "0.25rem 0 0 0", color: "#999", fontSize: "0.75rem" }}>{subtitle}</p>
      )}
    </div>
  </div>
);

const DashboardPage = () => {
  const router = useRouter();
  const token = getToken();

  const [stats, setStats] = useState<any>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");

  useEffect(() => {
    if (!token) {
      router.push("/login");
      return;
    }

    const fetchDashboardData = async () => {
      try {
        setLoading(true);
        const response = await apiClient.get("/dashboard/stats");
        if (response.data.success) {
          setStats(response.data.data);
        }
        setError("");
      } catch (err: any) {
        console.error("Error fetching dashboard data:", err);
        setError(err.response?.data?.message || "Failed to fetch dashboard data");
      } finally {
        setLoading(false);
      }
    };

    fetchDashboardData();
  }, [token, router]);

  if (loading) {
    return (
      <DashboardLayout>
        <div style={{ display: "flex", justifyContent: "center", alignItems: "center", minHeight: "400px" }}>
          <div style={{ textAlign: "center" }}>
            <div style={{ 
              width: "50px", 
              height: "50px", 
              border: "4px solid #f3f3f3", 
              borderTop: "4px solid #3b82f6",
              borderRadius: "50%",
              animation: "spin 1s linear infinite",
              margin: "0 auto 20px"
            }} />
            <p style={{ color: "#666" }}>Loading dashboard...</p>
          </div>
        </div>
      </DashboardLayout>
    );
  }

  if (error) {
    return (
      <DashboardLayout>
        <div style={{
          backgroundColor: "#fee2e2",
          color: "#991b1b",
          padding: "2rem",
          borderRadius: "12px",
          border: "1px solid #fecaca",
          textAlign: "center"
        }}>
          <FaExclamationTriangle size={40} style={{ marginBottom: "1rem" }} />
          <h3>Error Loading Dashboard</h3>
          <p>{error}</p>
        </div>
      </DashboardLayout>
    );
  }

  if (!stats) return null;

  // Admin Dashboard
  if (stats.role === "admin") {
    return (
      <DashboardLayout>
        <div style={{ maxWidth: "1400px" }}>
          {/* Header */}
          <div style={{ marginBottom: "2rem" }}>
            <h1 style={{ fontSize: "2.5rem", fontWeight: "bold", color: "#1e3a8a", margin: 0 }}>
              üë®‚Äçüíº Admin Dashboard
            </h1>
            <p style={{ color: "#666", marginTop: "0.5rem", fontSize: "1.1rem" }}>
              Welcome back, {stats.user.fullName}! Here's your complete system overview.
            </p>
          </div>

          {/* Key Metrics */}
          <div style={{ marginBottom: "3rem" }}>
            <h2 style={{ fontSize: "1.5rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
              üìä Key Metrics
            </h2>
            <div style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fit, minmax(250px, 1fr))",
              gap: "1.5rem",
            }}>
              <StatCard
                icon={FaBox}
                label="Total Devices"
                count={stats.devices.total}
                color="#3b82f6"
                bgColor="#3b82f6"
                subtitle={`${stats.devices.assigned} assigned`}
              />
              <StatCard
                icon={FaUsers}
                label="Total Users"
                count={stats.users.total}
                color="#10b981"
                bgColor="#10b981"
                subtitle="System-wide"
              />
              <StatCard
                icon={FaSchool}
                label="Total Schools"
                count={stats.schools.total}
                color="#f59e0b"
                bgColor="#f59e0b"
                subtitle="Registered"
              />
              <StatCard
                icon={FaCheckCircle}
                label="Available Devices"
                count={((stats.devices.byStatus && stats.devices.byStatus.Available) || 0)}
                color="#8b5cf6"
                bgColor="#8b5cf6"
                subtitle="Ready to assign"
              />
            </div>
          </div>

          {/* Devices Overview */}
          <div style={{ marginBottom: "3rem" }}>
            <h2 style={{ fontSize: "1.5rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
              üíª Devices by Category
            </h2>
            <div style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fit, minmax(200px, 1fr))",
              gap: "1.25rem",
            }}>
              <div style={{
                backgroundColor: "white",
                padding: "1.5rem",
                borderRadius: "12px",
                boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)",
                borderLeft: "4px solid #3b82f6"
              }}>
                <FaLaptop size={30} color="#3b82f6" />
                <p style={{ margin: "0.75rem 0 0 0", color: "#666", fontSize: "0.875rem" }}>Laptops</p>
                <p style={{ margin: "0.5rem 0 0 0", fontSize: "2rem", fontWeight: "bold", color: "#3b82f6" }}>
                  {((stats.devices.byCategory && stats.devices.byCategory.Laptop) || 0)}
                </p>
              </div>
              <div style={{
                backgroundColor: "white",
                padding: "1.5rem",
                borderRadius: "12px",
                boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)",
                borderLeft: "4px solid #10b981"
              }}>
                <FaDesktop size={30} color="#10b981" />
                <p style={{ margin: "0.75rem 0 0 0", color: "#666", fontSize: "0.875rem" }}>Desktops</p>
                <p style={{ margin: "0.5rem 0 0 0", fontSize: "2rem", fontWeight: "bold", color: "#10b981" }}>
                  {((stats.devices.byCategory && stats.devices.byCategory.Desktop) || 0)}
                </p>
              </div>
              <div style={{
                backgroundColor: "white",
                padding: "1.5rem",
                borderRadius: "12px",
                boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)",
                borderLeft: "4px solid #f59e0b"
              }}>
                <FaTablet size={30} color="#f59e0b" />
                <p style={{ margin: "0.75rem 0 0 0", color: "#666", fontSize: "0.875rem" }}>Tablets</p>
                <p style={{ margin: "0.5rem 0 0 0", fontSize: "2rem", fontWeight: "bold", color: "#f59e0b" }}>
                  {((stats.devices.byCategory && stats.devices.byCategory.Tablet) || 0)}
                </p>
              </div>
              <div style={{
                backgroundColor: "white",
                padding: "1.5rem",
                borderRadius: "12px",
                boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)",
                borderLeft: "4px solid #8b5cf6"
              }}>
                <FaProjectDiagram size={30} color="#8b5cf6" />
                <p style={{ margin: "0.75rem 0 0 0", color: "#666", fontSize: "0.875rem" }}>Projectors</p>
                <p style={{ margin: "0.5rem 0 0 0", fontSize: "2rem", fontWeight: "bold", color: "#8b5cf6" }}>
                  {((stats.devices.byCategory && stats.devices.byCategory.Projector) || 0)}
                </p>
              </div>
              <div style={{
                backgroundColor: "white",
                padding: "1.5rem",
                borderRadius: "12px",
                boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)",
                borderLeft: "4px solid #ec4899"
              }}>
                <FaBox size={30} color="#ec4899" />
                <p style={{ margin: "0.75rem 0 0 0", color: "#666", fontSize: "0.875rem" }}>Others</p>
                <p style={{ margin: "0.5rem 0 0 0", fontSize: "2rem", fontWeight: "bold", color: "#ec4899" }}>
                  {((stats.devices.byCategory && stats.devices.byCategory.Others) || 0)}
                </p>
              </div>
            </div>
          </div>

          {/* Users by Role & Device Status */}
          <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(400px, 1fr))", gap: "2rem", marginBottom: "3rem" }}>
            {/* Users */}
            <div style={{
              backgroundColor: "white",
              padding: "2rem",
              borderRadius: "12px",
              boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)"
            }}>
              <h3 style={{ fontSize: "1.25rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
                üë• Users by Role
              </h3>
              <div style={{ display: "flex", flexDirection: "column", gap: "1rem" }}>
                {Object.entries(stats.users.byRole || {}).map(([role, count]: [string, any]) => (
                  <div key={role} style={{
                    display: "flex",
                    justifyContent: "space-between",
                    alignItems: "center",
                    padding: "1rem",
                    backgroundColor: "#f9fafb",
                    borderRadius: "8px"
                  }}>
                    <span style={{ fontWeight: "500", textTransform: "capitalize" }}>{role}</span>
                    <span style={{ fontSize: "1.5rem", fontWeight: "bold", color: "#3b82f6" }}>{count}</span>
                  </div>
                ))}
              </div>
            </div>

            {/* Device Status */}
            <div style={{
              backgroundColor: "white",
              padding: "2rem",
              borderRadius: "12px",
              boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)"
            }}>
              <h3 style={{ fontSize: "1.25rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
                üì¶ Device Status
              </h3>
              <div style={{ display: "flex", flexDirection: "column", gap: "1rem" }}>
                {Object.entries(stats.devices.byStatus || {}).map(([status, count]: [string, any]) => (
                  <div key={status} style={{
                    display: "flex",
                    justifyContent: "space-between",
                    alignItems: "center",
                    padding: "1rem",
                    backgroundColor: "#f9fafb",
                    borderRadius: "8px",
                    borderLeft: status === "Maintenance" ? "4px solid #f59e0b" : "4px solid #10b981"
                  }}>
                    <span style={{ fontWeight: "500" }}>{status}</span>
                    <span style={{ fontSize: "1.5rem", fontWeight: "bold", color: status === "Maintenance" ? "#f59e0b" : "#10b981" }}>{count}</span>
                  </div>
                ))}
              </div>
            </div>
          </div>

          {/* Recent Activities */}
          <div style={{
            backgroundColor: "white",
            padding: "2rem",
            borderRadius: "12px",
            boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)"
          }}>
            <h3 style={{ fontSize: "1.25rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
              üïí Recent Device Activities
            </h3>
            <div style={{ overflowX: "auto" }}>
              <table style={{ width: "100%", borderCollapse: "collapse" }}>
                <thead>
                  <tr style={{ backgroundColor: "#f9fafb", borderBottom: "2px solid #e5e7eb" }}>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Serial Number</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Category</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Status</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>School</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Date</th>
                  </tr>
                </thead>
                <tbody>
                  {stats.recentActivities?.map((activity: any) => (
                    <tr key={activity.id} style={{ borderBottom: "1px solid #e5e7eb" }}>
                      <td style={{ padding: "12px", fontFamily: "monospace" }}>{activity.serialNumber}</td>
                      <td style={{ padding: "12px" }}>{activity.category}</td>
                      <td style={{ padding: "12px" }}>
                        <span style={{
                          padding: "4px 12px",
                          borderRadius: "12px",
                          backgroundColor: activity.status === "Available" ? "#d1fae5" : "#fed7aa",
                          color: activity.status === "Available" ? "#065f46" : "#92400e",
                          fontSize: "0.875rem",
                          fontWeight: "500"
                        }}>
                          {activity.status}
                        </span>
                      </td>
                      <td style={{ padding: "12px" }}>{activity.schoolName}</td>
                      <td style={{ padding: "12px", color: "#666", fontSize: "0.875rem" }}>
                        {new Date(activity.createdAt).toLocaleDateString()}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </DashboardLayout>
    );
  }

  // RTB Staff Dashboard
  if (stats.role === "rtb-staff") {
    return (
      <DashboardLayout>
        <div style={{ maxWidth: "1400px" }}>
          <div style={{ marginBottom: "2rem" }}>
            <h1 style={{ fontSize: "2.5rem", fontWeight: "bold", color: "#1e3a8a", margin: 0 }}>
              üë®‚Äçüíº Staff Dashboard
            </h1>
            <p style={{ color: "#666", marginTop: "0.5rem", fontSize: "1.1rem" }}>
              Welcome back, {stats.user.fullName}! Manage devices and schools.
            </p>
          </div>

          {/* Key Metrics */}
          <div style={{ marginBottom: "3rem" }}>
            <div style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fit, minmax(250px, 1fr))",
              gap: "1.5rem",
            }}>
              <StatCard
                icon={FaBox}
                label="Total Devices"
                count={stats.devices.total}
                color="#3b82f6"
                bgColor="#3b82f6"
                subtitle={`${stats.devices.assigned} assigned`}
              />
              <StatCard
                icon={FaSchool}
                label="Total Schools"
                count={stats.schools.total}
                color="#10b981"
                bgColor="#10b981"
              />
              <StatCard
                icon={FaCheckCircle}
                label="Available"
                count={((stats.devices.byStatus && stats.devices.byStatus.Available) || 0)}
                color="#8b5cf6"
                bgColor="#8b5cf6"
              />
              <StatCard
                icon={FaTools}
                label="Maintenance"
                count={((stats.devices.byStatus && stats.devices.byStatus.Maintenance) || 0)}
                color="#f59e0b"
                bgColor="#f59e0b"
              />
            </div>
          </div>

          {/* Devices by Category */}
          <div style={{ marginBottom: "3rem" }}>
            <h2 style={{ fontSize: "1.5rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
              üíª Devices by Category
            </h2>
            <div style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fit, minmax(200px, 1fr))",
              gap: "1.25rem",
            }}>
              {Object.entries(stats.devices.byCategory || {}).map(([category, count]: [string, any]) => (
                <div key={category} style={{
                  backgroundColor: "white",
                  padding: "1.5rem",
                  borderRadius: "12px",
                  boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)",
                  textAlign: "center"
                }}>
                  <p style={{ margin: 0, color: "#666", fontSize: "0.875rem" }}>{category}</p>
                  <p style={{ margin: "0.75rem 0 0 0", fontSize: "2rem", fontWeight: "bold", color: "#3b82f6" }}>
                    {count}
                  </p>
                </div>
              ))}
            </div>
          </div>

          {/* Recent Activities */}
          <div style={{
            backgroundColor: "white",
            padding: "2rem",
            borderRadius: "12px",
            boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)"
          }}>
            <h3 style={{ fontSize: "1.25rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
              üïí Recent Device Activities
            </h3>
            <div style={{ overflowX: "auto" }}>
              <table style={{ width: "100%", borderCollapse: "collapse" }}>
                <thead>
                  <tr style={{ backgroundColor: "#f9fafb", borderBottom: "2px solid #e5e7eb" }}>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Serial Number</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Category</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Status</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>School</th>
                  </tr>
                </thead>
                <tbody>
                  {(stats.recentActivities || []).map((activity: any) => (
                    <tr key={activity.id} style={{ borderBottom: "1px solid #e5e7eb" }}>
                      <td style={{ padding: "12px", fontFamily: "monospace" }}>{activity.serialNumber}</td>
                      <td style={{ padding: "12px" }}>{activity.category}</td>
                      <td style={{ padding: "12px" }}>
                        <span style={{
                          padding: "4px 12px",
                          borderRadius: "12px",
                          backgroundColor: activity.status === "Available" ? "#d1fae5" : "#fed7aa",
                          color: activity.status === "Available" ? "#065f46" : "#92400e",
                          fontSize: "0.875rem"
                        }}>
                          {activity.status}
                        </span>
                      </td>
                      <td style={{ padding: "12px" }}>{activity.schoolName}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </DashboardLayout>
    );
  }

  // School Dashboard
  if (stats.role === "school") {
    return (
      <DashboardLayout>
        <div style={{ maxWidth: "1400px" }}>
          <div style={{ marginBottom: "2rem" }}>
            <h1 style={{ fontSize: "2.5rem", fontWeight: "bold", color: "#1e3a8a", margin: 0 }}>
              üè´ School Dashboard
            </h1>
            <p style={{ color: "#666", marginTop: "0.5rem", fontSize: "1.1rem" }}>
              {stats.school.schoolName} - {stats.school.district}
            </p>
          </div>

          {/* Alerts */}
          {(stats.alerts.maintenanceNeeded > 0 || stats.alerts.faultyDevices > 0) && (
            <div style={{
              backgroundColor: "#fef3c7",
              padding: "1.5rem",
              borderRadius: "12px",
              marginBottom: "2rem",
              border: "2px solid #f59e0b",
              display: "flex",
              gap: "1rem",
              alignItems: "center"
            }}>
              <FaExclamationTriangle size={30} color="#f59e0b" />
              <div>
                <h3 style={{ margin: 0, color: "#92400e", fontSize: "1.1rem" }}>‚ö†Ô∏è Attention Required</h3>
                <p style={{ margin: "0.5rem 0 0 0", color: "#92400e" }}>
                  {stats.alerts.maintenanceNeeded > 0 && `${stats.alerts.maintenanceNeeded} device(s) in maintenance. `}
                  {stats.alerts.faultyDevices > 0 && `${stats.alerts.faultyDevices} faulty device(s).`}
                </p>
              </div>
            </div>
          )}

          {/* Key Metrics */}
          <div style={{ marginBottom: "3rem" }}>
            <div style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fit, minmax(250px, 1fr))",
              gap: "1.5rem",
            }}>
              <StatCard
                icon={FaBox}
                label="Total Devices"
                count={stats.devices.total}
                color="#3b82f6"
                bgColor="#3b82f6"
                subtitle="At your school"
              />
              <StatCard
                icon={FaCheckCircle}
                label="Available"
                count={stats.devices.available}
                color="#10b981"
                bgColor="#10b981"
              />
              <StatCard
                icon={FaTools}
                label="In Maintenance"
                count={stats.devices.maintenance}
                color="#f59e0b"
                bgColor="#f59e0b"
              />
              <StatCard
                icon={FaExclamationTriangle}
                label="Faulty"
                count={stats.alerts.faultyDevices}
                color="#ef4444"
                bgColor="#ef4444"
              />
            </div>
          </div>

          {/* Devices by Category & Condition */}
          <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(400px, 1fr))", gap: "2rem", marginBottom: "3rem" }}>
            {/* By Category */}
            <div style={{
              backgroundColor: "white",
              padding: "2rem",
              borderRadius: "12px",
              boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)"
            }}>
              <h3 style={{ fontSize: "1.25rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
                üíª By Category
              </h3>
              <div style={{ display: "flex", flexDirection: "column", gap: "1rem" }}>
                {Object.entries(stats.devices.byCategory || {}).map(([category, count]: [string, any]) => (
                  <div key={category} style={{
                    display: "flex",
                    justifyContent: "space-between",
                    alignItems: "center",
                    padding: "1rem",
                    backgroundColor: "#f9fafb",
                    borderRadius: "8px"
                  }}>
                    <span style={{ fontWeight: "500" }}>{category}</span>
                    <span style={{ fontSize: "1.5rem", fontWeight: "bold", color: "#3b82f6" }}>{count}</span>
                  </div>
                ))}
              </div>
            </div>

            {/* By Condition */}
            <div style={{
              backgroundColor: "white",
              padding: "2rem",
              borderRadius: "12px",
              boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)"
            }}>
              <h3 style={{ fontSize: "1.25rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
                üîß By Condition
              </h3>
              <div style={{ display: "flex", flexDirection: "column", gap: "1rem" }}>
                {Object.entries(stats.devices.byCondition || {}).map(([condition, count]: [string, any]) => (
                  <div key={condition} style={{
                    display: "flex",
                    justifyContent: "space-between",
                    alignItems: "center",
                    padding: "1rem",
                    backgroundColor: "#f9fafb",
                    borderRadius: "8px",
                    borderLeft: condition === "Faulty" ? "4px solid #ef4444" : "4px solid #10b981"
                  }}>
                    <span style={{ fontWeight: "500" }}>{condition}</span>
                    <span style={{ fontSize: "1.5rem", fontWeight: "bold", color: condition === "Faulty" ? "#ef4444" : "#10b981" }}>{count}</span>
                  </div>
                ))}
              </div>
            </div>
          </div>

          {/* Recent Devices */}
          <div style={{
            backgroundColor: "white",
            padding: "2rem",
            borderRadius: "12px",
            boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)"
          }}>
            <h3 style={{ fontSize: "1.25rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
              üì¶ Your Devices
            </h3>
            <div style={{ overflowX: "auto" }}>
              <table style={{ width: "100%", borderCollapse: "collapse" }}>
                <thead>
                  <tr style={{ backgroundColor: "#f9fafb", borderBottom: "2px solid #e5e7eb" }}>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Asset Tag</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Category</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Brand/Model</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Status</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Condition</th>
                  </tr>
                </thead>
                <tbody>
                  {(stats.recentDevices || []).map((device: any) => (
                    <tr key={device.id} style={{ borderBottom: "1px solid #e5e7eb" }}>
                      <td style={{ padding: "12px", fontFamily: "monospace", fontWeight: "600" }}>{device.assetTag || "-"}</td>
                      <td style={{ padding: "12px" }}>{device.category}</td>
                      <td style={{ padding: "12px" }}>{device.brand} {device.model}</td>
                      <td style={{ padding: "12px" }}>
                        <span style={{
                          padding: "4px 12px",
                          borderRadius: "12px",
                          backgroundColor: device.status === "Available" ? "#d1fae5" : "#fed7aa",
                          color: device.status === "Available" ? "#065f46" : "#92400e",
                          fontSize: "0.875rem"
                        }}>
                          {device.status}
                        </span>
                      </td>
                      <td style={{ padding: "12px" }}>
                        <span style={{
                          padding: "4px 12px",
                          borderRadius: "12px",
                          backgroundColor: device.condition === "Faulty" ? "#fee2e2" : "#d1fae5",
                          color: device.condition === "Faulty" ? "#991b1b" : "#065f46",
                          fontSize: "0.875rem"
                        }}>
                          {device.condition}
                        </span>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </DashboardLayout>
    );
  }

  // Technician Dashboard
  if (stats.role === "technician") {
    return (
      <DashboardLayout>
        <div style={{ maxWidth: "1400px" }}>
          <div style={{ marginBottom: "2rem" }}>
            <h1 style={{ fontSize: "2.5rem", fontWeight: "bold", color: "#1e3a8a", margin: 0 }}>
              üîß Technician Dashboard
            </h1>
            <p style={{ color: "#666", marginTop: "0.5rem", fontSize: "1.1rem" }}>
              Welcome back, {stats.user.fullName}! Your maintenance workload.
            </p>
          </div>

          {/* Workload Alert */}
          {stats.workload.totalTasks > 0 && (
            <div style={{
              backgroundColor: "#fef3c7",
              padding: "1.5rem",
              borderRadius: "12px",
              marginBottom: "2rem",
              border: "2px solid #f59e0b",
              display: "flex",
              gap: "1rem",
              alignItems: "center"
            }}>
              <FaClock size={30} color="#f59e0b" />
              <div>
                <h3 style={{ margin: 0, color: "#92400e", fontSize: "1.1rem" }}>‚ö†Ô∏è Pending Tasks</h3>
                <p style={{ margin: "0.5rem 0 0 0", color: "#92400e" }}>
                  You have {stats.workload.totalTasks} device(s) requiring attention.
                </p>
              </div>
            </div>
          )}

          {/* Key Metrics */}
          <div style={{ marginBottom: "3rem" }}>
            <div style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fit, minmax(250px, 1fr))",
              gap: "1.5rem",
            }}>
              <StatCard
                icon={FaTools}
                label="Pending Maintenance"
                count={stats.workload.pendingMaintenance}
                color="#f59e0b"
                bgColor="#f59e0b"
                subtitle="Awaiting repair"
              />
              <StatCard
                icon={FaExclamationTriangle}
                label="Faulty Devices"
                count={stats.workload.faultyDevices}
                color="#ef4444"
                bgColor="#ef4444"
                subtitle="Need attention"
              />
              <StatCard
                icon={FaTasks}
                label="Total Tasks"
                count={stats.workload.totalTasks}
                color="#8b5cf6"
                bgColor="#8b5cf6"
                subtitle="Your workload"
              />
              <StatCard
                icon={FaBox}
                label="Total Devices"
                count={stats.devices.total}
                color="#3b82f6"
                bgColor="#3b82f6"
                subtitle="System-wide"
              />
            </div>
          </div>

          {/* Device Condition Overview */}
          <div style={{
            backgroundColor: "white",
            padding: "2rem",
            borderRadius: "12px",
            boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)",
            marginBottom: "3rem"
          }}>
            <h3 style={{ fontSize: "1.25rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
              üîß Device Condition Overview
            </h3>
            <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(150px, 1fr))", gap: "1rem" }}>
              {Object.entries(stats.devices.byCondition || {}).map(([condition, count]: [string, any]) => (
                <div key={condition} style={{
                  padding: "1.5rem",
                  backgroundColor: "#f9fafb",
                  borderRadius: "8px",
                  textAlign: "center",
                  borderTop: condition === "Faulty" ? "4px solid #ef4444" : "4px solid #10b981"
                }}>
                  <p style={{ margin: 0, color: "#666", fontSize: "0.875rem" }}>{condition}</p>
                  <p style={{ margin: "0.75rem 0 0 0", fontSize: "2rem", fontWeight: "bold", color: condition === "Faulty" ? "#ef4444" : "#10b981" }}>
                    {count}
                  </p>
                </div>
              ))}
            </div>
          </div>

          {/* Maintenance Queue */}
          <div style={{
            backgroundColor: "white",
            padding: "2rem",
            borderRadius: "12px",
            boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)"
          }}>
            <h3 style={{ fontSize: "1.25rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
              üìã Maintenance Queue
            </h3>
            <div style={{ overflowX: "auto" }}>
              <table style={{ width: "100%", borderCollapse: "collapse" }}>
                <thead>
                  <tr style={{ backgroundColor: "#f9fafb", borderBottom: "2px solid #e5e7eb" }}>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Asset Tag</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Category</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Brand/Model</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Condition</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>School</th>
                    <th style={{ padding: "12px", textAlign: "left", fontWeight: "600" }}>Updated</th>
                  </tr>
                </thead>
                <tbody>
                  {(stats.maintenanceQueue || []).map((device: any) => (
                    <tr key={device.id} style={{ borderBottom: "1px solid #e5e7eb" }}>
                      <td style={{ padding: "12px", fontFamily: "monospace", fontWeight: "600" }}>{device.assetTag || device.serialNumber}</td>
                      <td style={{ padding: "12px" }}>{device.category}</td>
                      <td style={{ padding: "12px" }}>{device.brand} {device.model}</td>
                      <td style={{ padding: "12px" }}>
                        <span style={{
                          padding: "4px 12px",
                          borderRadius: "12px",
                          backgroundColor: device.condition === "Faulty" ? "#fee2e2" : "#fef3c7",
                          color: device.condition === "Faulty" ? "#991b1b" : "#92400e",
                          fontSize: "0.875rem"
                        }}>
                          {device.condition}
                        </span>
                      </td>
                      <td style={{ padding: "12px" }}>{device.schoolName}</td>
                      <td style={{ padding: "12px", color: "#666", fontSize: "0.875rem" }}>
                        {new Date(device.updatedAt).toLocaleDateString()}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </DashboardLayout>
    );
  }

  return <DashboardLayout><div>Unknown role</div></DashboardLayout>;
};

export default DashboardPage; 
  icon: IconComponent, 
  label, 
  count, 
  color,
  bgColor 
}: { 
  icon: React.ComponentType<any>
  label: string
  count: number
  color: string
  bgColor: string
}) => (
  <div
    style={{
      backgroundColor: "white",
      borderRadius: "12px",
      padding: "1.5rem",
      boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)",
      display: "flex",
      alignItems: "center",
      gap: "1.5rem",
      transition: "all 0.3s ease",
      cursor: "pointer",
      border: `2px solid ${bgColor}20`,
    }}
    onMouseEnter={(e) => {
      e.currentTarget.style.boxShadow = "0 4px 16px rgba(0, 0, 0, 0.15)";
      e.currentTarget.style.transform = "translateY(-4px)";
    }}
    onMouseLeave={(e) => {
      e.currentTarget.style.boxShadow = "0 2px 8px rgba(0, 0, 0, 0.1)";
      e.currentTarget.style.transform = "translateY(0)";
    }}
  >
    <div
      style={{
        width: "60px",
        height: "60px",
        borderRadius: "12px",
        backgroundColor: `${bgColor}20`,
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        flexShrink: 0,
      }}
    >
      <IconComponent size="32" color={color} />
    </div>
    <div>
      <p style={{ margin: 0, color: "#666", fontSize: "0.875rem", fontWeight: "500" }}>{label}</p>
      <p style={{ margin: "0.5rem 0 0 0", fontSize: "2rem", fontWeight: "bold", color }}>
        {count}
      </p>
    </div>
  </div>
);

const DashboardPage = () => {
  const router = useRouter();
  const token = getToken();

  // Device counts
  const [laptopCount, setLaptopCount] = useState(0);
  const [projectorCount, setProjectorCount] = useState(0);
  const [otherDeviceCount, setOtherDeviceCount] = useState(0);

  // User counts by role
  const [staffCount, setStaffCount] = useState(0);
  const [headTeacherCount, setHeadTeacherCount] = useState(0);
  const [adminCount, setAdminCount] = useState(0);

  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");

  useEffect(() => {
    if (!token) {
      router.push("/login");
      return;
    }

    const fetchData = async () => {
      try {
        setLoading(true);
        // Fetch current user profile
        const profileRes = await apiClient.get("/profile/me");
        // In a real scenario, you'd fetch actual counts from the backend
        // For now, setting mock data
        setStaffCount(12);
        setHeadTeacherCount(3);
        setAdminCount(2);

        // Fetch devices count
        setLaptopCount(45);
        setProjectorCount(8);
        setOtherDeviceCount(15);

        setError("");
      } catch (err: any) {
        console.error("Error fetching dashboard data:", err);
        setError("Failed to fetch dashboard data");
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [token, router]);

  const cardStyle = {
    backgroundColor: "#ffffff",
    borderRadius: "15px",
    border: "1px solid #e0e0e0",
    minHeight: "200px",
  };

  const subCardStyle = {
    backgroundColor: "#ffffff",
    borderRadius: "12px",
    border: "1px solid #e0e0e0",
    padding: "1rem",
    height: "100%",
    display: "flex",
    flexDirection: "column" as const,
    justifyContent: "space-between",
  };

  return (
    <DashboardLayout>
      <div style={{ maxWidth: "1400px" }}>
        {/* Header */}
        <div style={{ marginBottom: "2rem" }}>
          <h1 style={{ fontSize: "2rem", fontWeight: "bold", color: "#1e3a8a", margin: 0 }}>Dashboard</h1>
          <p style={{ color: "#666", marginTop: "0.5rem" }}>Welcome back! Here's your system overview.</p>
        </div>

        {/* Error Message */}
        {error && (
          <div
            style={{
              backgroundColor: "#fee2e2",
              color: "#991b1b",
              padding: "1rem",
              borderRadius: "8px",
              marginBottom: "1.5rem",
              border: "1px solid #fecaca",
            }}
          >
            {error}
          </div>
        )}

        {/* Devices Section */}
        <div style={{ marginBottom: "3rem" }}>
          <h2 style={{ fontSize: "1.5rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
            üì¶ Devices Overview
          </h2>
          <div
            style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fit, minmax(300px, 1fr))",
              gap: "1.5rem",
            }}
          >
            <StatCard
              icon={FaLaptop}
              label="Laptops"
              count={laptopCount}
              color="#3b82f6"
              bgColor="#3b82f6"
            />
            <StatCard
              icon={FaDesktop}
              label="Projectors"
              count={projectorCount}
              color="#10b981"
              bgColor="#10b981"
            />
            <StatCard
              icon={FaBox}
              label="Other Devices"
              count={otherDeviceCount}
              color="#f59e0b"
              bgColor="#f59e0b"
            />
          </div>
        </div>

        {/* Users Section */}
        <div style={{ marginBottom: "3rem" }}>
          <h2 style={{ fontSize: "1.5rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
            üë• Users Overview
          </h2>
          <div
            style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fit, minmax(300px, 1fr))",
              gap: "1.5rem",
            }}
          >
            <StatCard
              icon={FaUsers}
              label="Staff Members"
              count={staffCount}
              color="#8b5cf6"
              bgColor="#8b5cf6"
            />
            <StatCard
              icon={FaUserGraduate}
              label="Head Teachers"
              count={headTeacherCount}
              color="#ec4899"
              bgColor="#ec4899"
            />
            <StatCard
              icon={FaUserShield}
              label="Administrators"
              count={adminCount}
              color="#ef4444"
              bgColor="#ef4444"
            />
          </div>
        </div>

        {/* Summary Cards */}
        <div
          style={{
            backgroundColor: "white",
            borderRadius: "12px",
            padding: "2rem",
            boxShadow: "0 2px 8px rgba(0, 0, 0, 0.1)",
          }}
        >
          <h2 style={{ fontSize: "1.25rem", fontWeight: "bold", color: "#1e3a8a", marginBottom: "1.5rem" }}>
            üìä Summary Statistics
          </h2>
          <div
            style={{
              display: "grid",
              gridTemplateColumns: "repeat(auto-fit, minmax(200px, 1fr))",
              gap: "1rem",
            }}
          >
            <div
              style={{
                padding: "1rem",
                backgroundColor: "#f0f9ff",
                borderRadius: "8px",
                borderLeft: "4px solid #3b82f6",
              }}
            >
              <p style={{ margin: 0, color: "#666", fontSize: "0.875rem" }}>Total Devices</p>
              <p style={{ margin: "0.5rem 0 0 0", fontSize: "1.5rem", fontWeight: "bold", color: "#3b82f6" }}>
                {laptopCount + projectorCount + otherDeviceCount}
              </p>
            </div>
            <div
              style={{
                padding: "1rem",
                backgroundColor: "#f0fdf4",
                borderRadius: "8px",
                borderLeft: "4px solid #10b981",
              }}
            >
              <p style={{ margin: 0, color: "#666", fontSize: "0.875rem" }}>Total Users</p>
              <p style={{ margin: "0.5rem 0 0 0", fontSize: "1.5rem", fontWeight: "bold", color: "#10b981" }}>
                {staffCount + headTeacherCount + adminCount}
              </p>
            </div>
            <div
              style={{
                padding: "1rem",
                backgroundColor: "#fef3c7",
                borderRadius: "8px",
                borderLeft: "4px solid #f59e0b",
              }}
            >
              <p style={{ margin: 0, color: "#666", fontSize: "0.875rem" }}>System Status</p>
              <p style={{ margin: "0.5rem 0 0 0", fontSize: "1.5rem", fontWeight: "bold", color: "#f59e0b" }}>
                Active
              </p>
            </div>
          </div>
        </div>
      </div>
    </DashboardLayout>
  );
};

export default DashboardPage;
